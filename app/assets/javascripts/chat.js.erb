$(document).ready(function() {
  var dispatcher = new WebSocketRails('localhost:3000/websocket');

  dispatcher.on_open = function(data) {
    console.log('connected');
  }

  dispatcher.bind('new_message', function(data) {
    console.log(data);
    if(data.message_body != ''){
      var user = data.user_name;
      if(user == 'RedditChat Server')
        user = "<span class='label label-danger'>RedditChat Server</span> ";
      else if(user.indexOf("@") <= -1){
        user = "<span class='label label-primary'><a style='color:#FFFFFF' href='http://www.reddit.com/user/" + data.user_name + "' target='_blank'>" + data.user_name + "</a></span> ";
      }
      else{
        user = "<span class='label label-success'>" + data.user_name + "</span> ";
      }
      if($('#sub').val() == data.subreddit){
        $('#chat').append(user + data.message_body+"<br>");
      }
    }
  });

  $('#input-message').on('submit', function(event) {
    event.preventDefault();
    var message = $('#message').val();

    dispatcher.trigger('new_message', {
      message_body: message,
      subreddit: $('#sub').val()
    });
    $('#message').val('');
  });

  $('#submit_button').click(function() {
    window.location="/r/"+document.getElementById("subreddit").value;
  });
});