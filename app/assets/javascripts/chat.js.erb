$(document).ready(function() {
  var dispatcher = new WebSocketRails('localhost:3000/websocket');

  dispatcher.on_open = function(data) {
    console.log('connected');
  }

  dispatcher.bind('new_message', function(data) {
    console.log(data);
    if($('#sub').val() == data.subreddit){
      $('#chat').append(data.user_name + ": " + data.message_body+"<br>");
    }
  });

  $('#input-message').on('submit', function(event) {
    event.preventDefault();
    var message = $('#message').val();

    dispatcher.trigger('new_message', {
      message_body: message,
      subreddit: $('#sub').val()
    });
    $('#message').val('');
  });
});