$(document).ready(function() {
  var dispatcher = new WebSocketRails('localhost:3000/websocket');

  dispatcher.on_open = function(data) {
    console.log('connected');
  }

  dispatcher.bind('new_message', function(data) {
    console.log(data);
    var user = data.user_name;
    if(user.indexOf("@") <= -1){
      user = "<a href='http://www.reddit.com/user/" + data.user_name + "' target='_blank'>" + data.user_name + "</a>";
    }
    if($('#sub').val() == data.subreddit){
      $('#chat').append(user + ": " + data.message_body+"<br>");
    }
  });

  $('#input-message').on('submit', function(event) {
    event.preventDefault();
    var message = $('#message').val();

    dispatcher.trigger('new_message', {
      message_body: message,
      subreddit: $('#sub').val()
    });
    $('#message').val('');
  });

  function leave(){
    dispatcher.unbind('new_message');
  }
});